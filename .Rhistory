devtools::load_all()
ROBT_201920 <- RivOtter_FeedSigns %>%
dplyr::filter(SurveySeason == "2019 - 2020")
out_ras <- forage_density(ROBT_201920, 'FeedCat')
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, add_hillshade = TRUE)
Otter_catch <- 'run/data/Otter_Catch_fix.gpkg'
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, add_hillshade = TRUE)
devtools::load_all()
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, add_hillshade = TRUE)
devtools::load_all()
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, add_hillshade = TRUE)
devtools::load_all()
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, add_hillshade = TRUE)
?osmdata::opq
devtools::load_all()
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, add_hillshade = TRUE)
beaver_forage
devtools::load_all()
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, add_hillshade = TRUE)
beaver_forage
# ----- Functions ------
fsd_ggplot <- function(.data, p.ext){
plot_title <- pull(.data[1,], 1)[1]
fsd <- forage_density(.data, 'FeedCat', kd_extent = p.ext) %>%
plot_forage_density(.,axes_units = FALSE, guide = FALSE,  catchment = OC_sf, rivers = TRUE, add_hillshade = TRUE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s',plot_title))
}
target_ext <- inflate_bbox(OC_sf, 10)
# load otter catchment
OC_sf <- sf::read_sf('run/data/Otter_Catch_fix.gpkg')
library(ggspatial)
# ----- Functions ------
fsd_ggplot <- function(.data, p.ext){
plot_title <- pull(.data[1,], 1)[1]
fsd <- forage_density(.data, 'FeedCat', kd_extent = p.ext) %>%
plot_forage_density(.,axes_units = FALSE, guide = FALSE,  catchment = OC_sf, rivers = TRUE, add_hillshade = TRUE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s',plot_title))
}
target_ext <- inflate_bbox(OC_sf, 10)
Otter_kde_list <- RivOtter_FeedSigns %>%
group_by(SurveySeason) %>%
group_split()%>%
purrr::map(., ~fsd_ggplot(., target_ext))
Otter_kde_list[4]
630*2
891*2
img <- image_graph(1260, 1782, res = 200)
print(Otter_kde_list)
dev.off()
animation <- image_animate(magick::image_morph(img,  frames = 12), fps = 4, optimize = TRUE)
# dev.off()
# print(animation)
image_write(animation, "run/maps/OtterKdeAnimation_bw.gif")
img <- image_graph(1200, 675, res = 96)
print(Otter_kde_list)
dev.off()
animation <- image_animate(magick::image_morph(img,  frames = 10), fps = 5, optimize = TRUE)
# dev.off()
# print(animation)
image_write(animation, "run/maps/Otter_anim_bw_twitter.gif")
?magick::image_graph
devtools::load_all()
devtools::load_all()
Otter_kde_list <- RivOtter_FeedSigns %>%
group_by(SurveySeason) %>%
group_split()%>%
purrr::map(., ~fsd_ggplot(., target_ext)) %>%
animate_maps(., filename = 'run/maps/Otter_anim_test.gif')
Otter_kde_list
devtools::load_all()
# load otter catchment
OC_sf <- 'run/data/Otter_Catch_fix.gpkg'
devtools::document()
Otter_catch <- 'run/data/Otter_Catch_fix.gpkg'
devtools::load_all()
# load otter catchment
OC_sf <- 'run/data/Otter_Catch_fix.gpkg'
# ----- Functions ------
fsd_ggplot <- function(.data, p.ext){
plot_title <- pull(.data[1,], 1)[1]
fsd <- forage_density(.data, 'FeedCat', kd_extent = p.ext) %>%
plot_forage_density(.,axes_units = FALSE, guide = FALSE,  catchment = OC_sf, rivers = TRUE, add_hillshade = TRUE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s',plot_title))
}
target_ext <- inflate_bbox(OC_sf, 10)
target_ext
library(sf)
# library(sp)
# library(raster)
# library(ggspatial)
# library(gridExtra)
library(magick)
library(magrittr)
library(tidyverse)
devtools::load_all()
devtools::document()
sf::write_sf(RivOtter_OtherSigns, 'C:/HG_Projects/SideProjects/files_Jake/shps/DwellingsDams.shp' )
library(sf)
library(magrittr)
library(tidyverse)
devtools::load_all()
devtools::document()
Otter_catch <- 'run/data/Otter_Catch_fix.gpkg'
ROBT_201920 <- RivOtter_FeedSigns %>%
dplyr::filter(SurveySeason == "2019 - 2020")
out_ras <- forage_density(ROBT_201920, 'FeedCat')
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, add_hillshade = TRUE)
CS_201920 <- RivOtter_OtherSigns %>%
dplyr::filter(SurveySeason == "2019 - 2020")
beaver_forage
# ------- simple test ---------------
# create an extent...
target_ext <- inflate_bbox(OC_sf, 10)
# ------- simple test ---------------
# create a plotting extent...
target_ext <- inflate_bbox(Otter_catch, 10)
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, plot_extent = target_ext)
beaver_forage
CS_201920 <- RivOtter_OtherSigns %>%
dplyr::filter(SurveySeason == "2019 - 2020")
otter_poly <- estimate_territories(out_ras, confirm_signs = CS_201920)
check_auto_terr(otter_poly, basemap=FALSE, label=FALSE)
check_auto_terr(otter_poly, basemap=FALSE, label=TRUE)
otter_poly_uc <- user_classify(otter_poly, territory = c(10, 28))
check_user_terr(otter_poly_uc, basemap=FALSE)
plot_territories(otter_poly_uc, 'user_class', basemap=TRUE)
plot_territories(otter_poly_uc, 'user_class', basemap=TRUE, catchment = Otter_catch, rivers = TRUE, plot_extent = target_ext)
plot_territories(otter_poly_uc, 'mean_fd', basemap=FALSE)
plot_territories(otter_poly_uc, 'sum_fd', basemap=FALSE, trans_type = 'log10')
plot_territories(otter_poly_uc, 'id', basemap=TRUE, guide = FALSE, label = TRUE, drop_act = TRUE, axes_units = FALSE)
plot_territories(otter_poly_uc, 'id', basemap=TRUE, guide = FALSE, label = TRUE, drop_act = TRUE, axes_units = FALSE,
catchment = Otter_catch, rivers = TRUE, plot_extent = target_ext)
# ------- simple test ---------------
# create a plotting extent...
target_ext <- inflate_bbox(Otter_catch, 10)
# ---------- panel plot all ROBT kde maps --------------
# plotting functions:
# kde plots for panel
fsd_ggplot <- function(.data, p.ext){
plot_title <- pull(.data[1,], 1)[1]
fsd <- plot_forage_density(.data, north_arrow = FALSE, scalebar = FALSE, guide = FALSE,
catchment = Otter_catch, rivers = TRUE, plot_extent = target_ext) +
labs(subtitle = sprintf('Beaver Foraging Density: plot_title'))
}
otter_poly_uc
# ---------- panel plot all ROBT kde maps --------------
# plotting functions:
# kde plots for panel/animation
fsd_ggplot <- function(.data, p.ext, add_map_stuff= FALSE){
plot_title <- pull(.data[1,], 1)[1]
fsd <- plot_forage_density(.data, north_arrow = FALSE, scalebar = FALSE, guide = FALSE,
catchment = Otter_catch, rivers = TRUE, plot_extent = p.ext) +
labs(subtitle = sprintf('Beaver Foraging Density: plot_title'))
if (isTRUE(add_map_stuff)){
fsd <- plot_forage_density(.data, guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = p.ext) +
labs(subtitle = sprintf('Beaver Foraging Density: plot_title'))
}
}
# territory plots for panels/animation
terr_ggplot <- function(.data, p.ext, add_map_stuff= FALSE){
plot_title <- pull(.data[1,], 1)[1]
fsd <- plot_territories(.data, 'terr_status', north_arrow = FALSE, scalebar = FALSE, guide = FALSE,
catchment = Otter_catch, rivers = TRUE, plot_extent = p.ext) +
labs(subtitle = sprintf('Beaver Foraging Density: plot_title'))
if (isTRUE(add_map_stuff)){
fsd <- plot_territories(.data,'terr_status', guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = p.ext) +
labs(subtitle = sprintf('Beaver Foraging Density: plot_title'))
}
}
# get constant extent for all plots
ras_ext <- inflate_bbox(RivOtter_FeedSigns, 250)
kde_ras_list <- RivOtter_FeedSigns %>%
group_by(SurveySeason) %>%
group_split()%>%
purrr::map(., ~forage_density(., 'FeedCat', kd_extent = ras_ext))
Otter_confirm_list <- RivOtter_OtherSigns %>%
group_by(SurveySeason) %>%
group_split()
auto_terr_list <- kde_ras_list %>%
purrr::map(., ~purrr::map2(.x = ., .y= Otter_confirm_list,
.f = ~ estimate_territories(.x, confirm_signs = Otter_confirm_list)))
auto_terr_list <- kde_ras_list %>%
purrr::map(., ~purrr::map2(.x = ., .y= Otter_confirm_list,
.f = ~ estimate_territories(.x, .y)))
auto_terr_list <- kde_ras_list %>%
purrr::map2(.x = ., .y= Otter_confirm_list,
.f = ~ estimate_territories(.x, .y))
kde_plot_list <-kde_ras_list %>%
purr::map(., ~fsd_ggplot(., target_ext)) %>%
panel_plot()
kde_plot_list <-kde_ras_list %>%
purrr::map(., ~fsd_ggplot(., target_ext)) %>%
panel_plot()
# get name list for plots
plot_names <- unique(RivOtter_FeedSigns$SurveySeason)
plot_names
# ---------- panel plot all ROBT kde maps --------------
# plotting functions:
# kde plots for panel/animation
fsd_ggplot <- function(.data, p.names, p.ext, add_map_stuff= FALSE){
if (isTRUE(add_map_stuff)){
fsd <- plot_forage_density(.data, guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = p.ext) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
} else {
fsd <- plot_forage_density(.data, north_arrow = FALSE, scalebar = FALSE, guide = FALSE,
catchment = Otter_catch, rivers = TRUE, plot_extent = p.ext) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
}
return(fsd)
}
# territory plots for panels/animation
terr_ggplot <- function(.data, p.names, p.ext, add_map_stuff= FALSE){
if (isTRUE(add_map_stuff)){
terr <- plot_territories(.data,'terr_status', guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = p.ext) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
} else {
terr <- plot_territories(.data, 'terr_status', north_arrow = FALSE, scalebar = FALSE, guide = FALSE,
catchment = Otter_catch, rivers = TRUE, plot_extent = p.ext) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
}
return(terr)
}
kde_panel <- kde_ras_list %>%
purrr::map2(.x=., .y=plot_names, ~fsd_ggplot(.x, .y, target_ext)) %>%
panel_plot(.)
kde_panel
# ---------- panel plot all ROBT kde maps --------------
# plotting functions:
# kde plots for panel/animation
fsd_ggplot <- function(.data, p.names, p.ext, add_map_stuff= FALSE){
if (isTRUE(add_map_stuff)){
fsd <- plot_forage_density(.data, guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = p.ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
} else {
fsd <- plot_forage_density(.data, axes_units = FALSE, north_arrow = FALSE, scalebar = FALSE, guide = FALSE,
catchment = Otter_catch, rivers = TRUE, plot_extent = p.ext) +
labs(subtitle = p.names)
}
return(fsd)
}
# territory plots for panels/animation
terr_ggplot <- function(.data, p.names, p.ext, add_map_stuff= FALSE){
if (isTRUE(add_map_stuff)){
terr <- plot_territories(.data,'terr_status', guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = p.ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
} else {
terr <- plot_territories(.data, 'terr_status', axes_units = FALSE, north_arrow = FALSE, scalebar = FALSE, guide = FALSE,
catchment = Otter_catch, rivers = TRUE, plot_extent = p.ext) +
labs(subtitle =  p.names)
}
return(terr)
}
kde_panel <- kde_ras_list %>%
purrr::map2(.x=., .y=plot_names, ~fsd_ggplot(.x, .y, target_ext)) %>%
panel_plot(.)
kde_panel
terr_panel <- auto_terr_list %>%
purr::map2(.x=., .y=plot_names, ~terr_ggplot(.x, .y, target_ext))%>%
panel_plot(.)
terr_panel <- auto_terr_list %>%
purrr::map2(.x=., .y=plot_names, ~terr_ggplot(.x, .y, target_ext))%>%
panel_plot(.)
terr_panel
kde_animation <- kde_ras_list %>%
purrr::map2(.x=., .y=plot_names, ~fsd_ggplot(.x, .y, target_ext, add_map_stuff = TRUE)) %>%
animate_maps(., filename = 'run/maps/Otter_kde_test1.gif')
# territory plots for panels/animation
terr_ggplot <- function(.data, p.names, p.ext, add_map_stuff= FALSE){
if (isTRUE(add_map_stuff)){
terr <- plot_territories(.data,'terr_status', guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = p.ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
} else {
terr <- plot_territories(.data, 'terr_status', axes_units = FALSE, north_arrow = FALSE, scalebar = FALSE, guide = TRUE,
catchment = Otter_catch, rivers = TRUE, plot_extent = p.ext) +
labs(subtitle =  p.names)
}
return(terr)
}
terr_animation <- auto_terr_list %>%
purrr::map2(.x=., .y=plot_names, ~terr_ggplot(.x, .y, target_ext, add_map_stuff = TRUE))%>%
animate_maps(., filename = 'run/maps/Otter_terr_test1.gif')
# territory plots for panels/animation
terr_ggplot <- function(.data, p.names, p.ext, add_map_stuff= FALSE){
if (isTRUE(add_map_stuff)){
terr <- plot_territories(.data,'terr_status', guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = p.ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
} else {
terr <- plot_territories(.data, 'terr_status', axes_units = FALSE, north_arrow = FALSE, scalebar = FALSE,
catchment = Otter_catch, rivers = TRUE, plot_extent = p.ext) +
labs(subtitle =  p.names)
}
return(terr)
}
terr_animation <- auto_terr_list %>%
purrr::map2(.x=., .y=plot_names, ~terr_ggplot(.x, .y, target_ext, add_map_stuff = TRUE))%>%
animate_maps(., filename = 'run/maps/Otter_terr_test1.gif')
auto_terr_list
plot_territories(otter_poly_uc, 'user_class', basemap=TRUE, catchment = Otter_catch, rivers = TRUE, plot_extent = target_ext)
# territory plots for panels/animation
terr_ggplot <- function(.data, p.names, p.ext, add_map_stuff= FALSE){
if (isTRUE(add_map_stuff)){
terr <- plot_territories(.data,'terr_status', guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = p.ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
} else {
terr <- plot_territories(.data, 'terr_status', axes_units = FALSE, north_arrow = FALSE, scalebar = FALSE,
catchment = Otter_catch, rivers = TRUE, plot_extent = p.ext, guide=FALSE) +
labs(subtitle =  p.names)
}
return(terr)
}
terr_animation <- auto_terr_list %>%
purrr::map2(.x=., .y=plot_names, ~terr_ggplot(.x, .y, target_ext, add_map_stuff = TRUE))%>%
animate_maps(., filename = 'run/maps/Otter_terr_test1.gif')
# ---- side by side animation ------------
library(patchwork)
sidebyside_ggplot <- function(.kde, .terr, p.names, p.ext){
fsd <- plot_forage_density(.data, guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = p.ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
terr <- plot_territories(.data,'terr_status', guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = p.ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
return(fsd + terr)
}
joint_animation <- purrr::pmap(list(kde_ras_list, auto_terr_list, plot_names),
sidebyside_ggplot(first, second, third, target_ext))
obj_list <- list(ras = kde_ras_list, terr = auto_terr_list, pnames = plot_names)
joint_animation <- purrr::pmap(obj_list, sidebyside_ggplot(ras, terr, pnames, target_ext))
target_extL <- list(rep(target_ext, length(plot_names)))
target_extL
target_extL <- list(rep(list(target_ext), length(plot_names)))
target_extL
list(target_ext)
rep(list(target_ext), length(plot_names))
target_extL <- rep(list(target_ext), length(plot_names))
obj_list <- list(ras = kde_ras_list, terr = auto_terr_list, pnames = plot_names, pext = target_extL)
joint_animation <- purrr::pmap(obj_list, sidebyside_ggplot(ras, terr, pnames, pext))
obj_list <- list(ras = kde_ras_list, terr = auto_terr_list, pnames = plot_names, pext = target_extL)
obj_list
joint_animation <- purrr::pmap(obj_list, sidebyside_ggplot(ras, terr, pnames, pext))
target_extL <- rep((target_ext), length(plot_names))
target_extL
list(rep((target_ext), length(plot_names)))
rep(list(target_ext), length(plot_names))
kde_ras_list
target_extL <- rep(list(target_ext), length(plot_names))
obj_list <- list(ras = kde_ras_list, terr = auto_terr_list, pnames = plot_names, pext = target_extL)
joint_animation <- purrr::pmap(obj_list, sidebyside_ggplot(.kde =  ras,.terr = terr, p.names=pnames, p.ext= pext))
sidebyside_ggplot <- function(.kde, .terr, p.names, p.ext){
fsd <- plot_forage_density(.data, guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = p.ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
terr <- plot_territories(.data,'terr_status', guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = p.ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
return(fsd + terr)
}
target_extL <- rep(list(target_ext), length(plot_names))
obj_list <- list(ras = kde_ras_list, terr = auto_terr_list, pnames = plot_names, pext = target_extL)
joint_animation <- purrr::pmap(obj_list, sidebyside_ggplot(.kde =  ras,.terr = terr, p.names=pnames, p.ext= pext))
target_extL <- rep(list(target_ext), length(plot_names))
obj_list <- list(ras = kde_ras_list, terr = auto_terr_list, pnames = plot_names)
joint_animation <- purrr::pmap(obj_list, sidebyside_ggplot(.kde =  ras,.terr = terr, p.names=pnames))
sidebyside_ggplot <- function(.kde, .terr, p.names){
fsd <- plot_forage_density(.data, guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
terr <- plot_territories(.data,'terr_status', guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
return(fsd + terr)
}
obj_list <- list(ras = kde_ras_list, terr = auto_terr_list, pnames = plot_names)
joint_animation <- purrr::pmap(obj_list, sidebyside_ggplot(.kde =  ras,.terr = terr, p.names=pnames))
sidebyside_ggplot <- function(.kde, .terr, p.names){
fsd <- plot_forage_density(.data, guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
print('B1')
terr <- plot_territories(.data,'terr_status', guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
print('B2')
return(fsd + terr)
}
obj_list <- list(ras = kde_ras_list, terr = auto_terr_list, pnames = plot_names)
joint_animation <- purrr::pmap(.l=obj_list,.f= sidebyside_ggplot(.kde =  ras,.terr = terr, p.names=pnames))
sidebyside_ggplot <- function(.kde, .terr, p.names){
fsd <- plot_forage_density(.kde, guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
print('B1')
terr <- plot_territories(.terr,'terr_status', guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE) +
labs(subtitle = sprintf('Beaver Foraging Density: %s', p.names))
print('B2')
return(fsd + terr)
}
obj_list <- list(ras = kde_ras_list, terr = auto_terr_list, pnames = plot_names)
joint_animation <- purrr::pmap(.l=obj_list,.f= sidebyside_ggplot(.kde =  ras,.terr = terr, p.names=pnames))
obj_list <- list(kde_ras_list, auto_terr_list, plot_names)
joint_animation <- purrr::pmap(.l=obj_list,.f= sidebyside_ggplot(first, second, third))
plot_names
obj_list <- list(ras = kde_ras_list, terr = auto_terr_list, pnames = plot_names)
joint_animation <- purrr::pmap(.l=obj_list,.f= sidebyside_ggplot(ras, terr, pnames))
?pmap
obj_list <- list(kde_ras_list, auto_terr_list, plot_names)
joint_animation <- purrr::pmap(.l=obj_list,.f= sidebyside_ggplot(..1, ..2, ..3))
joint_animation <- purrr::pmap(.l=obj_list,.f= sidebyside_ggplot(.kde=..1, .terr=..2, p.names=..3))
sidebyside_ggplot <- function(.kde, .terr){
fsd <- plot_forage_density(.kde, guide = FALSE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE)
terr <- plot_territories(.terr,'terr_status', guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE)
return(fsd + terr)
}
obj_list <- list(kde_ras_list, auto_terr_list, plot_names)
joint_animation <- purrr::map2(.x=kde_ras_list,.y=auto_terr_list, .f= sidebyside_ggplot(.x, .y))
joint_animation <- purrr::map2(.x=kde_ras_list,.y=auto_terr_list, ~sidebyside_ggplot(.x, .y))
joint_animation[1]
obj_list <- list(kde_ras_list, auto_terr_list, plot_names)
joint_animation <- purrr::pmap(.l=obj_list, ~sidebyside_ggplot(..1, ..2, ..3))
sidebyside_ggplot <- function(.kde, .terr, p.name){
fsd <- plot_forage_density(.kde, guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE) +
theme(legend.position="left")
terr <- plot_territories(.terr,'terr_status', guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE)
combined <- fsd + terr +
+ plot_annotation(
subtitle = sprintf('beaver map: %s'), p.name)
return(combined)
}
obj_list <- list(kde_ras_list, auto_terr_list, plot_names)
joint_animation <- purrr::pmap(.l=obj_list, ~sidebyside_ggplot(..1, ..2, ..3))
sidebyside_ggplot <- function(.kde, .terr, p.name){
fsd <- plot_forage_density(.kde, guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE) +
theme(legend.position="left")
terr <- plot_territories(.terr,'terr_status', guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE)
combined <- fsd + terr +
+ plot_annotation(
subtitle = sprintf('beaver map: %s', p.name))
return(combined)
}
obj_list <- list(kde_ras_list, auto_terr_list, plot_names)
joint_animation <- purrr::pmap(.l=obj_list, ~sidebyside_ggplot(..1, ..2, ..3))
joint_animation[4]
sidebyside_ggplot <- function(.kde, .terr, p.name){
fsd <- plot_forage_density(.kde, guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE) +
theme(legend.position="left")
terr <- plot_territories(.terr,'terr_status', guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE)
combined <- fsd + terr
combined <- combined  + plot_annotation(
subtitle = sprintf('beaver map: %s', p.name))
return(combined)
}
obj_list <- list(kde_ras_list, auto_terr_list, plot_names)
joint_animation <- purrr::pmap(.l=obj_list, ~sidebyside_ggplot(..1, ..2, ..3))
joint_animation <- purrr::pmap(.l=obj_list, ~sidebyside_ggplot(..1, ..2, ..3))
joint_animation[4]
patch_animate <- animate_maps(joint_animation, filename = 'run/maps/Otter_comb_test1.gif')
devtools::load_all()
out_ras <- forage_density(ROBT_201920, 'FeedCat', standardise = TRUE)
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, plot_extent = target_ext)
beaver_forage
CS_201920 <- RivOtter_OtherSigns %>%
dplyr::filter(SurveySeason == "2019 - 2020")
otter_poly <- estimate_territories(out_ras, confirm_signs = CS_201920)
check_auto_terr(otter_poly, basemap=FALSE, label=TRUE)
devtools::load_all()
out_ras <- forage_density(ROBT_201920, 'FeedCat')
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, plot_extent = target_ext)
beaver_forage
devtools::load_all()
out_ras <- forage_density(ROBT_201920, 'FeedCat')
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, plot_extent = target_ext)
beaver_forage
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, plot_extent = target_ext, trans_fill=F)
beaver_forage
1e-6/2
devtools::document()
devtools::load_all()
sidebyside_ggplot <- function(.kde, .terr, p.name){
fsd <- plot_forage_density(.kde, guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE) +
theme(legend.position="left")
terr <- plot_territories(.terr,'terr_status', guide = TRUE, catchment = Otter_catch,
rivers = TRUE, plot_extent = target_ext, axes_units = FALSE)
combined <- fsd + terr
combined <- combined  + plot_annotation(
subtitle = sprintf('Beaver forage density and automated territory classification: %s', p.name))
return(combined)
}
obj_list <- list(kde_ras_list, auto_terr_list, plot_names)
joint_animation <- purrr::pmap(.l=obj_list, ~sidebyside_ggplot(..1, ..2, ..3)) %>%
animate_maps(., filename = 'run/maps/Otter_comb_test1.gif', fps=4)
beaver_forage <- plot_forage_density(out_ras, catchment = Otter_catch, rivers = TRUE, plot_extent = target_ext, trans_fill=T)
beaver_forage
check_auto_terr(otter_poly, basemap=FALSE, label=TRUE)
